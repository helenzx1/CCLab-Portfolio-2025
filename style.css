let stars = [];          
let showOrbit = false;  

function setup() {
  createCanvas(600, 600);

  // Create some stars
  for (let i = 0; i < 120; i++) {
    stars.push({
      x: random(width),
      y: random(height/2),
      size: random(1.5, 3),
      bright: random(0.8, 1.2),
      twinkle: random(0.03, 0.08)
    });
  }
}

function draw() {
  let simulatedHour = (frameCount / 30) % 24;
  let realSecond = second();

  setSkyColor(simulatedHour);

  if (showOrbit) {
    drawOrbit();
  }

  drawSunMoon(simulatedHour);

  if (isNight(simulatedHour)) {
    drawStars(simulatedHour);
  }

  drawSea(realSecond, simulatedHour);

  drawTimeText(simulatedHour);
}

// Night = 7pmâ€“6am
function isNight(hour) {
  return hour >= 19 || hour < 6;
}

// éŸ“ç³»æŸ”å’Œå¤©ç©ºè‰²
function setSkyColor(hour) {
  let skyColor;
  
  if (hour >= 5 && hour < 7) { 
    // Dawn   â†’ éŸ©ç³»ç²‰é‡‘è‰²
    let t = map(hour, 5, 7, 0, 1);
    skyColor = lerpColor(color(255, 190, 210), color(200, 220, 255), t);
  }
  else if (hour >= 7 && hour < 17) { 
    // Day â†’ æ›´å¥¶è“è‰²
    let t = map(hour, 7, 17, 0, 1);
    skyColor = lerpColor(color(200, 220, 255), color(180, 205, 245), t);
  }
  else if (hour >= 17 && hour < 19) { 
    // Sunset â†’ éŸ©ç³»æ©˜ç²‰æ¸å˜
    let t = map(hour, 17, 19, 0, 1);
    skyColor = lerpColor(color(255, 180, 180), color(160, 180, 220), t);
  }
  else { 
    // Night â†’ æ·±è“ç´«
    let t = hour >= 19 ? map(hour, 19, 24, 0, 1) : map(hour, 0, 5, 1, 0);
    skyColor = lerpColor(color(160, 180, 220), color(40, 50, 95), t);
  }
  
  background(skyColor);
}

// Cute éŸ©é£Žå¤ªé˜³æœˆäº®
function drawSunMoon(hour) {
  let angle;
  let radius = 200;
  let centerX = width/2 - 100;  
  let centerY = height/2 + 100;  

  if (!isNight(hour)) {
    let t = map(hour, 5, 17, 0, 1);
    angle = lerp(-PI, 0, t);
  } else {
    let t = hour >= 19 ? map(hour, 19, 24, 0, 0.416) : map(hour, 0, 5, 0.416, 1);
    angle = lerp(0, -PI, t);
  }

  let posX = centerX + cos(angle) * radius;
  let posY = centerY + sin(angle) * radius;

  if (!isNight(hour)) {
    // ðŸŒž æŸ”ç²‰å¤ªé˜³
    noStroke();
    fill(255, 235, 145);
    ellipse(posX, posY, 90, 90);
    fill(255, 210, 160);
    ellipse(posX, posY, 70, 70);
    fill(255, 190, 160);
    ellipse(posX, posY, 50, 50);
  } else {
    // ðŸŒ™ å°å¯çˆ±æœˆäº®ï¼ˆå¥¶ç™½ï¼‰
    noStroke();
    fill(255, 255, 255, 240);
    ellipse(posX, posY, 65, 65);
    fill(50, 60, 120);
    ellipse(posX + 8, posY - 8, 65, 65);
  }
}

// éŸ©é£Žæ˜Ÿæ˜Ÿæ›´é—ªäº®
function drawStars(hour) {
  let nightBright = (hour > 21 || hour < 3) ? 1.2 : 0.8;
  noStroke();
  for (let star of stars) {
    let flickerAlpha = 170 + sin(frameCount * star.twinkle) * 120;
    fill(255, 245, 250, flickerAlpha * star.bright * nightBright);
    ellipse(star.x, star.y, star.size * 2, star.size * 2);
  }
}

// éŸ©ç³»æµ…è“æµ·é¢
function drawSea(realSecond, simulatedHour) {
  let seaLevel = height - map(simulatedHour, 0, 24, 50, height/2);
  let waveOffset = sin(realSecond * 0.5) * 12;

  noStroke();
  fill(150, 190, 255);
  rect(0, seaLevel + waveOffset, width, height - (seaLevel + waveOffset));

  noFill();
  stroke(180, 210, 255);
  strokeWeight(2.5);
  beginShape();
  for (let x = 0; x <= width; x += 10) {
    let waveY = seaLevel + waveOffset + sin((x * 0.02) + (realSecond * 0.5)) * 12;
    vertex(x, waveY);
  }
  endShape();
}

// Cute æ—¶é—´æ˜¾ç¤º
function drawTimeText(simulatedHour) {
  noStroke();
  fill(255);
  textSize(22);
  textAlign(LEFT, TOP);
  text("â° " + nf(floor(simulatedHour), 2) + ":00", 20, 40);
}

// Orbit for debugging
function drawOrbit() {
  let radius = 200;
  let centerX = width/2 - 100;  
  let centerY = height/2 + 100;

  noFill();
  stroke(255, 140);
  strokeWeight(1);
  ellipse(centerX, centerY, radius*2, radius*0.8);
}
